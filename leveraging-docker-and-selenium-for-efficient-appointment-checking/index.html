<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Leveraging Docker and Selenium for Efficient Appointment Checking | Tomas Balza</title>
<meta name=keywords content="docker,selenium,python,git,automation"><meta name=description content="This article explores an automation use-case with Selenium and Docker to periodically access a multi-page js form and check for available appointments."><meta name=author content><link rel=canonical href=https://tbalza.net/leveraging-docker-and-selenium-for-efficient-appointment-checking/><link crossorigin=anonymous href=/assets/css/stylesheet.72f49d8e688f8b26198abd212dc2ce9fe1d22eddc415e9c17e8ac38ab047d5ab.css integrity="sha256-cvSdjmiPiyYZir0hLcLOn+HSLt3EFenBforDirBH1as=" rel="preload stylesheet" as=style><link rel=icon href=https://tbalza.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tbalza.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tbalza.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tbalza.net/apple-touch-icon.png><link rel=mask-icon href=https://tbalza.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tbalza.net/leveraging-docker-and-selenium-for-efficient-appointment-checking/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Leveraging Docker and Selenium for Efficient Appointment Checking"><meta property="og:description" content="This article explores an automation use-case with Selenium and Docker to periodically access a multi-page js form and check for available appointments."><meta property="og:type" content="article"><meta property="og:url" content="https://tbalza.net/leveraging-docker-and-selenium-for-efficient-appointment-checking/"><meta property="og:image" content="https://tbalza.net/posts/selenium_automation/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tbalza.net/posts/selenium_automation/cover.png"><meta name=twitter:title content="Leveraging Docker and Selenium for Efficient Appointment Checking"><meta name=twitter:description content="This article explores an automation use-case with Selenium and Docker to periodically access a multi-page js form and check for available appointments."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tbalza.net/posts/"},{"@type":"ListItem","position":2,"name":"Leveraging Docker and Selenium for Efficient Appointment Checking","item":"https://tbalza.net/leveraging-docker-and-selenium-for-efficient-appointment-checking/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Leveraging Docker and Selenium for Efficient Appointment Checking","name":"Leveraging Docker and Selenium for Efficient Appointment Checking","description":"This article explores an automation use-case with Selenium and Docker to periodically access a multi-page js form and check for available appointments.","keywords":["docker","selenium","python","git","automation"],"articleBody":"In the fast-paced world of DevOps and automation, efficiency and reliability are paramount. Today, we delve into a Docker-based automation script that epitomizes these qualities. Our focus is a python script that utilizes SeleniumBase to navigate through multi-page JavaScript forms to identify available appointments.\nThis script not only operates seamlessly in the background, checking for appointments, but also notifies users via email, attaching screenshots upon successful detection. This process builds on our previous discussions on deploying applications using Docker, illustrating the breadth and versatility of containerization in modern development workflows.\nFind the complete setup on instructions in the GitHub repository.\nYour browser does not support the video tag. Selenium: The Backbone of Web Automation Selenium is more than just a tool; it’s a comprehensive framework that enables developers to automate web browser interactions. Imagine you’re testing a web application that sells concert tickets. Selenium allows you to write a script that mimics a user purchasing a ticket, from selecting a seat to filling out payment information. This ensures that your application behaves as expected across different web browsers and operating systems.\nThe Role of Selenium in DevOps and CI/CD In a continuous deployment pipeline, automated testing is crucial. Selenium automates the testing of web applications, fitting perfectly into the CI/CD pipeline. For example, each time a developer commits changes to the codebase, Selenium tests can automatically run to verify that the web application still meets all functional requirements. This immediate feedback is vital for maintaining software quality in a fast-paced development environment.\nSelenium vs. SeleniumBase: Enhancing Automation While Selenium sets the stage for web automation, SeleniumBase takes it a step further by simplifying test case creation. With Selenium, you might write extensive code to navigate through a form and verify its contents. SeleniumBase encapsulates common patterns, such as waiting for elements to become visible or clicking elements, into simpler, more robust commands. This not only makes the test code cleaner but also more resilient to changes in the web application.\nUsing SeleniumBase, a script to check for available appointments might navigate through a series of dropdowns to select a location and service type with just a few lines of code, handling waits and clicks more efficiently than raw Selenium code.\nWith plain Selenium, selecting a dropdown would require this code,\n# Tramite select wait.until(EC.visibility_of_element_located((By.ID, 'tramiteGrupo[0]'))) # Wait for second AJAX page to Load dropdown2 = wait.until(EC.element_to_be_clickable((By.ID, 'tramiteGrupo[0]'))) dropdown2.click() # Ensure the dropdown is opened, might be necessary to trigger JavaScript select_element2 = Select(dropdown2) select_element2.select_by_visible_text('Toma de huella (expedicion de tarjeta). renovacion de tarjeta larga duracion y duplicado') option = wait.until(EC.visibility_of_element_located((By.XPATH, \"//select[@id='tramiteGrupo[0]']/option[contains(text(Toma de huella (expedicion de tarjeta)))]\"))) driver.execute_script(\"arguments[0].click();\",option) Using SeleniumBase methods, the code above is simply,\nsb.select_option_by_text(\"#tramiteGrupo\\\\[0\\\\]\", config['tramiteOptionText']) Selenium IDE Using tools such as Selenium IDE we can manually navigate the form completion process and record the CSS selectors, streamlining the conversion to SeleniumBase’s API later on.\nNavigating with SeleniumBase SeleniumBase offers the uc mode, which employs undetected-chromedriver to evade detection mechanisms that websites use to block automated browsers. This is particularly useful for appointment checking on sites with anti-bot measures.\nDocker’s Role in Streamlining Development Docker encapsulates applications and their environments into containers, ensuring consistency across development, testing, and production. In the context of web scraping and automation, Docker ensures that your SeleniumBase scripts run in an environment where all dependencies are met, regardless of the host system.\nDockerizing the Python Script The Dockerfile starts from a Ubuntu base image, installs Chrome and the necessary drivers, and adds the script. This container can then be run on any system with Docker, without the need for additional setup.\n# SeleniumBase Docker Image FROM ubuntu:18.04 WORKDIR /cita-checker/SeleniumBase #======================================= # Install Python and Basic Python Tools #======================================= RUN apt-get -o Acquire::Check-Valid-Until=false -o Acquire::Check-Date=false update RUN apt-get install -y python3 python3-pip python3-setuptools python3-dev python-distribute RUN alias python=python3 RUN echo \"alias python=python3\" \u003e\u003e ~/.bashrc #================ # Install Chrome #================ RUN curl -sS -o - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \u0026\u0026 \\ echo \"deb http://dl.google.com/linux/chrome/deb/ stable main\" \u003e\u003e /etc/apt/sources.list.d/google-chrome.list \u0026\u0026 \\ apt-get -yqq update \u0026\u0026 \\ apt-get -yqq install google-chrome-stable \u0026\u0026 \\ rm -rf /var/lib/apt/lists/* Since we are using git submodules, fetching the script with git clone --recurse-submodules https://github.com/tbalza/cita-checker.git will allow us to create custom features, such as VNC access for manual interaction, while keeping the original repo untouched, streamlining development.\n#=========================================== # Install VNC Server, Window Manager, NoVNC #=========================================== ENV DISPLAY=:99.0 ENV DEBIAN_FRONTEND=noninteractive RUN apt-get update \u0026\u0026 apt-get install -y \\ python-numpy \\ net-tools \\ x11vnc \\ xfce4 \\ xfce4-goodies \\ \u0026\u0026 rm -rf /var/lib/apt/lists/* RUN mkdir -p /.novnc \u0026\u0026 cd /.novnc \\ \u0026\u0026 wget -qO- https://github.com/novnc/noVNC/archive/v1.0.0.tar.gz | tar xz --strip 1 -C $PWD \\ \u0026\u0026 mkdir /.novnc/utils/websockify \\ \u0026\u0026 wget -qO- https://github.com/novnc/websockify/archive/v0.6.1.tar.gz | tar xz --strip 1 -C /.novnc/utils/websockify \\ \u0026\u0026 ln -s /.novnc/vnc.html /.novnc/index.html EXPOSE 5900 EXPOSE 6080 With an entry point we can define the commands that will keep all our extra services running, tying up all the configuration. In our setup configuring Xvfb is crucial for our desktop environment and VNC to work alongside the SeleniumBase webdriver in headful mode.\n#!/bin/bash # Function to keep the Xvfb running function keepUpScreen() { echo \"Running keepUpScreen()\" while true; do sleep 1 if [ -z \"$(pidof Xvfb)\" ]; then echo \"Xvfb is not running. Starting Xvfb...\" Xvfb :99 -screen 0 1600x900x16 \u0026 fi done } # Configure and start Xvfb export DISPLAY=:99.0 rm -f /tmp/.X99-lock \u0026\u003e/dev/null # remove the lock file for X server display number 99 Xvfb :99 -screen 0 1600x900x16 \u0026 # Start xfce startxfce4 \u0026 # Start x11vnc without a password, accessible only from localhost x11vnc -display :99 -rfbport 5900 -nopw -forever \u0026 # Keep Xvfb running keepUpScreen \u0026 # Wait for any background processes to finish wait $! # Execute commands passed to the Docker container exec \"$@\" Advantages of a Containerized Approach By dockerizing your appointment checking script, you not only ensure it runs in a consistent environment but also simplify deployment and scaling. If the script needs to run at multiple locations or at scale, Docker containers can be deployed across multiple machines or cloud instances seamlessly.\nPython Script for Appointment Checking The provided Python script utilizes SeleniumBase’s features to navigate a web form and check for appointments. It employs strategies like setting a random window size to mimic human behavior, running in headful mode to cater to the need for manual interaction, and using the uc mode to evade bot detection.\nA Closer Look at the Script’s Logic\nSetting Browser Settings and Opening the Appointment Page The script starts by opening the target URL with a random window size to avoid automation detection.\ndef set_random_window_size(sb): min_width = 800 # Define minimum width max_width = 1600 # Define maximum width width = random.randint(min_width, max_width) # Choose a random width within the range height = (width * 2) // 3 # Calculate the height based on a 3:2 aspect ratio sb.set_window_size(width, height) # Set the window size with the calculated width and height def check_for_appointments(): with SB( chromium_arg=\"--force-device-scale-factor=1\", # Needed to set window size browser=\"chrome\", # When running brave, leave it as chrome. Invokes chromedriver with default options # binary_location=\"/usr/bin/brave-browser\", # Uncomment for Brave Browser headed=True, # Run tests in headed/GUI mode on Linux. (To have access to browser after) uc=True, # Use undetected-chromedriver to evade bot-detection. Only works for Chrome/Brave use_auto_ext=False, # Hide chrome's automation extension slow=True, # Makes actions run slower incognito=True, # Enable Chromium's Incognito mode. Clear session cookies ) as sb: try: # Clicking logic to get to appointment status set_random_window_size(sb) # Adjust the browser window size (to avoid rate-limiting) Navigation and navigating through the form by selecting options and clicking buttons, demonstrating how SeleniumBase simplifies interaction with web elements.\n) as sb: try: # Clicking logic to get to appointment status set_random_window_size(sb) # Adjust the browser window size (to avoid rate-limiting) sb.open(config['url']) # Fetches values.json sb.click(\"#form\") sb.select_option_by_text(\"#form\", \"Barcelona\") sb.click(\"#btnAceptar\") sb.select_option_by_text(\"#tramiteGrupo\\\\[0\\\\]\", config['tramiteOptionText']) # Fetches values.json sb.click(\"#btnAceptar\") sb.click(\"#btnEntrar\") sb.type(\"#txtIdCitado\", config['idCitadoValue']) # Fetches values.json sb.type(\"#txtDesCitado\", config['desCitadoValue']) # Fetches values.json sb.select_option_by_text(\"#txtPaisNac\", config['paisNacValue']) # Fetches values.json sb.click(\"#btnEnviar\") sb.click(\"#btnEnviar\") Checking for Availability It then checks for text indicating whether appointments are available. If not found, it assumes availability and proceeds to take a screenshot for evidence, showcasing SeleniumBase’s ability to easily interact with web pages and perform checks. # Checking for appointment availability if sb.is_text_visible(\"En este momento no hay citas disponibles.\", \"div.mf-main--content.ac-custom-content p\"): logging.info(\"No available appointments. Trying again in 10 minutes.\") return \"retry\" else: # If the text is not found, assume an appointment is available sb.set_window_size(1280, 1024) # Set correct resolution for screenshot sb.save_screenshot(\"/tmp/cita_disponible.png\") # Take a screenshot for the email attachment send_email(\"Cita Disponible Alert\", \"VNC to vnc://127.0.0.1:5900 to complete\", attach_screenshot=True) logging.info(\"Appointments might be available. Keeping the browser open for manual check.\") user_input = input(\"Type 'restart' and enter\") if user_input.lower() == \"restart\": # SB Context manager quits automatically. workaround to maintain open return \"manual_check_needed\" except Exception as e: logging.error(f\"Encountered an error during the steps: {e}. Trying again in 10 minutes.\") return \"error\" Email Notifications Upon finding an available appointment, the script sends an email notification with the screenshot attached. This demonstrates integrating SeleniumBase with other Python libraries for complete automation solutions.\ndef send_email(subject, message, attach_screenshot=False): # Load email configuration from values.json with open('/tmp/values.json', 'r') as file: config = json.load(file) sender_email = config['sender_email'] receiver_email = config['receiver_email'] password = config['password'] smtp_server = config['smtp_server'] smtp_port = config['smtp_port'] # Create the email message msg = EmailMessage() msg['Subject'] = subject msg['From'] = sender_email # Fetches values.json msg['To'] = receiver_email # Fetches values.json msg.set_content(message) # Attach the screenshot if required if attach_screenshot: screenshot_path = \"/tmp/cita_disponible.png\" if os.path.exists(screenshot_path): with open(screenshot_path, 'rb') as f: file_data = f.read() file_name = os.path.basename(screenshot_path) msg.add_attachment(file_data, maintype='image', subtype='png', filename=file_name) # Send the email try: with smtplib.SMTP_SSL(smtp_server, smtp_port) as smtp: # Fetches values.json smtp.login(sender_email, password) # Fetches values.json smtp.send_message(msg) logging.info(\"Email sent successfully!\") except Exception as e: logging.error(f\"Error sending email: {e}\") Once the script finds an available appointment you’ll receive an email alert with a screenshot: You can set up a distinct alarm tone on your mobile phone for a particular sender to alert you during off-hours, as if you were on call.\nConclusion This detailed exploration showcases the power and versatility of using Docker and SeleniumBase for automating the task of checking for available appointments. Through practical examples and explanations, we’ve seen how these technologies can streamline the development and deployment of automation scripts, ensuring reliability, efficiency, and scalability in modern web application testing and automation tasks.\n","wordCount":"1723","inLanguage":"en","image":"https://tbalza.net/posts/selenium_automation/cover.png","datePublished":"2024-04-01T00:00:00Z","dateModified":"2024-04-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tbalza.net/leveraging-docker-and-selenium-for-efficient-appointment-checking/"},"publisher":{"@type":"Organization","name":"Tomas Balza","logo":{"@type":"ImageObject","url":"https://tbalza.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tbalza.net/ accesskey=h title="Tomas Balza (Alt + H)"><img src=https://tbalza.net/profile-photo-2.jpg alt aria-label=logo height=35>Tomas Balza<p id=subtitle>DevOps / Tech Articles</p></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://github.com/tbalza title=GitHub><span>GitHub</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/tomas-balza-b075141b3 title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.youtube.com/@tbalza-tech title=YouTube><span>YouTube</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Leveraging Docker and Selenium for Efficient Appointment Checking</h1><div class=post-meta><span title='2024-04-01 00:00:00 +0000 UTC'>April, 2024</span>&nbsp;&nbsp;&nbsp;<a href=/tags/docker> docker</a> <a href=/tags/selenium>selenium</a> <a href=/tags/python>python</a> <a href=/tags/git>git</a> <a href=/tags/automation>automation</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#selenium-the-backbone-of-web-automation aria-label="Selenium: The Backbone of Web Automation">Selenium: The Backbone of Web Automation</a><ul><li><a href=#the-role-of-selenium-in-devops-and-cicd aria-label="The Role of Selenium in DevOps and CI/CD">The Role of Selenium in DevOps and CI/CD</a></li><li><a href=#selenium-vs-seleniumbase-enhancing-automation aria-label="Selenium vs. SeleniumBase: Enhancing Automation">Selenium vs. SeleniumBase: Enhancing Automation</a></li><li><a href=#selenium-ide aria-label="Selenium IDE">Selenium IDE</a></li><li><a href=#navigating-with-seleniumbase aria-label="Navigating with SeleniumBase">Navigating with SeleniumBase</a></li></ul></li><li><a href=#dockers-role-in-streamlining-development aria-label="Docker&amp;rsquo;s Role in Streamlining Development">Docker&rsquo;s Role in Streamlining Development</a><ul><li><a href=#dockerizing-the-python-script aria-label="Dockerizing the Python Script">Dockerizing the Python Script</a></li><li><a href=#advantages-of-a-containerized-approach aria-label="Advantages of a Containerized Approach">Advantages of a Containerized Approach</a></li></ul></li><li><a href=#python-script-for-appointment-checking aria-label="Python Script for Appointment Checking">Python Script for Appointment Checking</a><ul><li><a href=#setting-browser-settings-and-opening-the-appointment-page aria-label="Setting Browser Settings and Opening the Appointment Page">Setting Browser Settings and Opening the Appointment Page</a></li><li><a href=#navigation aria-label=Navigation>Navigation</a></li><li><a href=#checking-for-availability aria-label="Checking for Availability">Checking for Availability</a></li><li><a href=#email-notifications aria-label="Email Notifications">Email Notifications</a></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"),document.querySelectorAll(".inner ul li a").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href").slice(1),n=document.getElementById(t);window.scrollTo({top:getOffsetTop(n)-75,behavior:"smooth"})})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset-60>0&&getOffsetTop(e)-window.pageYOffset-60<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.scrollY}</script><div class=post-content><p>In the fast-paced world of DevOps and automation, efficiency and reliability are paramount. Today, we delve into a Docker-based automation script that epitomizes these qualities. Our focus is a python script that utilizes SeleniumBase to navigate through multi-page JavaScript forms to identify available appointments.</p><p>This script not only operates seamlessly in the background, checking for appointments, but also notifies users via email, attaching screenshots upon successful detection. This process builds on our previous discussions on deploying applications using Docker, illustrating the breadth and versatility of containerization in modern development workflows.</p><p>Find the complete setup on instructions in the <a href=https://github.com/tbalza/cita-checker>GitHub repository</a>.</p><video width=720 loop autoplay muted>
<source src=/posts/selenium_automation/cita-check.mp4 type=video/mp4>Your browser does not support the video tag.</video><h3 id=selenium-the-backbone-of-web-automation>Selenium: The Backbone of Web Automation<a hidden class=anchor aria-hidden=true href=#selenium-the-backbone-of-web-automation>#</a></h3><p>Selenium is more than just a tool; it&rsquo;s a comprehensive framework that enables developers to automate web browser interactions. Imagine you&rsquo;re testing a web application that sells concert tickets. Selenium allows you to write a script that mimics a user purchasing a ticket, from selecting a seat to filling out payment information. This ensures that your application behaves as expected across different web browsers and operating systems.</p><h4 id=the-role-of-selenium-in-devops-and-cicd>The Role of Selenium in DevOps and CI/CD<a hidden class=anchor aria-hidden=true href=#the-role-of-selenium-in-devops-and-cicd>#</a></h4><p>In a continuous deployment pipeline, automated testing is crucial. Selenium automates the testing of web applications, fitting perfectly into the CI/CD pipeline. For example, each time a developer commits changes to the codebase, Selenium tests can automatically run to verify that the web application still meets all functional requirements. This immediate feedback is vital for maintaining software quality in a fast-paced development environment.</p><h4 id=selenium-vs-seleniumbase-enhancing-automation>Selenium vs. SeleniumBase: Enhancing Automation<a hidden class=anchor aria-hidden=true href=#selenium-vs-seleniumbase-enhancing-automation>#</a></h4><p>While Selenium sets the stage for web automation, SeleniumBase takes it a step further by simplifying test case creation. With Selenium, you might write extensive code to navigate through a form and verify its contents. SeleniumBase encapsulates common patterns, such as waiting for elements to become visible or clicking elements, into simpler, more robust commands. This not only makes the test code cleaner but also more resilient to changes in the web application.</p><p>Using SeleniumBase, a script to check for available appointments might navigate through a series of dropdowns to select a location and service type with just a few lines of code, handling waits and clicks more efficiently than raw Selenium code.</p><p>With plain Selenium, selecting a dropdown would require this code,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Tramite select</span>
</span></span><span class=line><span class=cl><span class=n>wait</span><span class=o>.</span><span class=n>until</span><span class=p>(</span><span class=n>EC</span><span class=o>.</span><span class=n>visibility_of_element_located</span><span class=p>((</span><span class=n>By</span><span class=o>.</span><span class=n>ID</span><span class=p>,</span> <span class=s1>&#39;tramiteGrupo[0]&#39;</span><span class=p>)))</span> <span class=c1># Wait for second AJAX page to Load</span>
</span></span><span class=line><span class=cl><span class=n>dropdown2</span> <span class=o>=</span> <span class=n>wait</span><span class=o>.</span><span class=n>until</span><span class=p>(</span><span class=n>EC</span><span class=o>.</span><span class=n>element_to_be_clickable</span><span class=p>((</span><span class=n>By</span><span class=o>.</span><span class=n>ID</span><span class=p>,</span> <span class=s1>&#39;tramiteGrupo[0]&#39;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>dropdown2</span><span class=o>.</span><span class=n>click</span><span class=p>()</span> <span class=c1># Ensure the dropdown is opened, might be necessary to trigger JavaScript</span>
</span></span><span class=line><span class=cl><span class=n>select_element2</span> <span class=o>=</span> <span class=n>Select</span><span class=p>(</span><span class=n>dropdown2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>select_element2</span><span class=o>.</span><span class=n>select_by_visible_text</span><span class=p>(</span><span class=s1>&#39;Toma de huella (expedicion de tarjeta). renovacion de tarjeta larga duracion y duplicado&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>option</span> <span class=o>=</span> <span class=n>wait</span><span class=o>.</span><span class=n>until</span><span class=p>(</span><span class=n>EC</span><span class=o>.</span><span class=n>visibility_of_element_located</span><span class=p>((</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span> <span class=s2>&#34;//select[@id=&#39;tramiteGrupo[0]&#39;]/option[contains(text(Toma de huella (expedicion de tarjeta)))]&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span><span class=s2>&#34;arguments[0].click();&#34;</span><span class=p>,</span><span class=n>option</span><span class=p>)</span>
</span></span></code></pre></div><p>Using SeleniumBase methods, the code above is simply,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sb</span><span class=o>.</span><span class=n>select_option_by_text</span><span class=p>(</span><span class=s2>&#34;#tramiteGrupo</span><span class=se>\\</span><span class=s2>[0</span><span class=se>\\</span><span class=s2>]&#34;</span><span class=p>,</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;tramiteOptionText&#39;</span><span class=p>])</span>
</span></span></code></pre></div><h4 id=selenium-ide>Selenium IDE<a hidden class=anchor aria-hidden=true href=#selenium-ide>#</a></h4><p>Using tools such as Selenium IDE we can manually navigate the form completion process and record the CSS selectors, streamlining the conversion to SeleniumBase&rsquo;s API later on.</p><p><img loading=lazy src=/posts/selenium_automation/selenium-ide.png alt=ide></p><h4 id=navigating-with-seleniumbase>Navigating with SeleniumBase<a hidden class=anchor aria-hidden=true href=#navigating-with-seleniumbase>#</a></h4><p>SeleniumBase offers the uc mode, which employs undetected-chromedriver to evade detection mechanisms that websites use to block automated browsers. This is particularly useful for appointment checking on sites with anti-bot measures.</p><h3 id=dockers-role-in-streamlining-development>Docker&rsquo;s Role in Streamlining Development<a hidden class=anchor aria-hidden=true href=#dockers-role-in-streamlining-development>#</a></h3><p>Docker encapsulates applications and their environments into containers, ensuring consistency across development, testing, and production. In the context of web scraping and automation, Docker ensures that your SeleniumBase scripts run in an environment where all dependencies are met, regardless of the host system.</p><h4 id=dockerizing-the-python-script>Dockerizing the Python Script<a hidden class=anchor aria-hidden=true href=#dockerizing-the-python-script>#</a></h4><p>The <code>Dockerfile</code> starts from a Ubuntu base image, installs Chrome and the necessary drivers, and adds the script. This container can then be run on any system with Docker, without the need for additional setup.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># SeleniumBase Docker Image</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> ubuntu:18.04</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /cita-checker/SeleniumBase</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#=======================================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Install Python and Basic Python Tools</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#=======================================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get -o Acquire::Check-Valid-Until<span class=o>=</span><span class=nb>false</span> -o Acquire::Check-Date<span class=o>=</span><span class=nb>false</span> update<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get install -y python3 python3-pip python3-setuptools python3-dev python-distribute<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>alias</span> <span class=nv>python</span><span class=o>=</span>python3<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>echo</span> <span class=s2>&#34;alias python=python3&#34;</span> &gt;&gt; ~/.bashrc<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Install Chrome</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> curl -sS -o - https://dl-ssl.google.com/linux/linux_signing_key.pub <span class=p>|</span> apt-key add - <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>echo</span> <span class=s2>&#34;deb http://dl.google.com/linux/chrome/deb/ stable main&#34;</span> &gt;&gt; /etc/apt/sources.list.d/google-chrome.list <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get -yqq update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get -yqq install google-chrome-stable <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span></code></pre></div><p>Since we are using git submodules, fetching the script with <code>git clone --recurse-submodules https://github.com/tbalza/cita-checker.git</code> will allow us to create custom features, such as VNC access for manual interaction, while keeping the original repo untouched, streamlining development.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c>#===========================================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Install VNC Server, Window Manager, NoVNC</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#===========================================</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>DISPLAY</span><span class=o>=</span>:99.0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>DEBIAN_FRONTEND</span><span class=o>=</span>noninteractive
</span></span><span class=line><span class=cl><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    python-numpy <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    net-tools <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    x11vnc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    xfce4 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    xfce4-goodies <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mkdir -p /.novnc <span class=o>&amp;&amp;</span> <span class=nb>cd</span> /.novnc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> wget -qO- https://github.com/novnc/noVNC/archive/v1.0.0.tar.gz <span class=p>|</span> tar xz --strip <span class=m>1</span> -C <span class=nv>$PWD</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> mkdir /.novnc/utils/websockify <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> wget -qO- https://github.com/novnc/websockify/archive/v0.6.1.tar.gz <span class=p>|</span> tar xz --strip <span class=m>1</span> -C /.novnc/utils/websockify <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> ln -s /.novnc/vnc.html /.novnc/index.html<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5900</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 6080</span><span class=err>
</span></span></span></code></pre></div><p>With an entry point we can define the commands that will keep all our extra services running, tying up all the configuration. In our setup configuring Xvfb is crucial for our desktop environment and VNC to work alongside the SeleniumBase webdriver in headful mode.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># Function to keep the Xvfb running</span>
</span></span><span class=line><span class=cl><span class=k>function</span> keepUpScreen<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Running keepUpScreen()&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        sleep <span class=m>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=k>$(</span>pidof Xvfb<span class=k>)</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span> <span class=s2>&#34;Xvfb is not running. Starting Xvfb...&#34;</span>
</span></span><span class=line><span class=cl>            Xvfb :99 -screen <span class=m>0</span> 1600x900x16 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Configure and start Xvfb</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>DISPLAY</span><span class=o>=</span>:99.0
</span></span><span class=line><span class=cl>rm -f /tmp/.X99-lock <span class=p>&amp;</span>&gt;/dev/null <span class=c1># remove the lock file for X server display number 99</span>
</span></span><span class=line><span class=cl>Xvfb :99 -screen <span class=m>0</span> 1600x900x16 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Start xfce</span>
</span></span><span class=line><span class=cl>startxfce4 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Start x11vnc without a password, accessible only from localhost</span>
</span></span><span class=line><span class=cl>x11vnc -display :99 -rfbport <span class=m>5900</span> -nopw -forever <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Keep Xvfb running</span>
</span></span><span class=line><span class=cl>keepUpScreen <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Wait for any background processes to finish</span>
</span></span><span class=line><span class=cl><span class=nb>wait</span> <span class=nv>$!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Execute commands passed to the Docker container</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></div><h4 id=advantages-of-a-containerized-approach>Advantages of a Containerized Approach<a hidden class=anchor aria-hidden=true href=#advantages-of-a-containerized-approach>#</a></h4><p>By dockerizing your appointment checking script, you not only ensure it runs in a consistent environment but also simplify deployment and scaling. If the script needs to run at multiple locations or at scale, Docker containers can be deployed across multiple machines or cloud instances seamlessly.</p><h3 id=python-script-for-appointment-checking>Python Script for Appointment Checking<a hidden class=anchor aria-hidden=true href=#python-script-for-appointment-checking>#</a></h3><p>The provided Python script utilizes SeleniumBase&rsquo;s features to navigate a web form and check for appointments. It employs strategies like setting a random window size to mimic human behavior, running in headful mode to cater to the need for manual interaction, and using the uc mode to evade bot detection.</p><p><strong>A Closer Look at the Script&rsquo;s Logic</strong></p><h4 id=setting-browser-settings-and-opening-the-appointment-page>Setting Browser Settings and Opening the Appointment Page<a hidden class=anchor aria-hidden=true href=#setting-browser-settings-and-opening-the-appointment-page>#</a></h4><p>The script starts by opening the target URL with a random window size to avoid automation detection.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>set_random_window_size</span><span class=p>(</span><span class=n>sb</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>min_width</span> <span class=o>=</span> <span class=mi>800</span>  <span class=c1># Define minimum width</span>
</span></span><span class=line><span class=cl>    <span class=n>max_width</span> <span class=o>=</span> <span class=mi>1600</span>  <span class=c1># Define maximum width</span>
</span></span><span class=line><span class=cl>    <span class=n>width</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>min_width</span><span class=p>,</span> <span class=n>max_width</span><span class=p>)</span>  <span class=c1># Choose a random width within the range</span>
</span></span><span class=line><span class=cl>    <span class=n>height</span> <span class=o>=</span> <span class=p>(</span><span class=n>width</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=o>//</span> <span class=mi>3</span>  <span class=c1># Calculate the height based on a 3:2 aspect ratio</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>set_window_size</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>)</span>  <span class=c1># Set the window size with the calculated width and height</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_for_appointments</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>SB</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>chromium_arg</span><span class=o>=</span><span class=s2>&#34;--force-device-scale-factor=1&#34;</span><span class=p>,</span>  <span class=c1># Needed to set window size</span>
</span></span><span class=line><span class=cl>            <span class=n>browser</span><span class=o>=</span><span class=s2>&#34;chrome&#34;</span><span class=p>,</span>  <span class=c1># When running brave, leave it as chrome. Invokes chromedriver with default options</span>
</span></span><span class=line><span class=cl>            <span class=c1># binary_location=&#34;/usr/bin/brave-browser&#34;,  # Uncomment for Brave Browser</span>
</span></span><span class=line><span class=cl>            <span class=n>headed</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># Run tests in headed/GUI mode on Linux. (To have access to browser after)</span>
</span></span><span class=line><span class=cl>            <span class=n>uc</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># Use undetected-chromedriver to evade bot-detection. Only works for Chrome/Brave</span>
</span></span><span class=line><span class=cl>            <span class=n>use_auto_ext</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># Hide chrome&#39;s automation extension</span>
</span></span><span class=line><span class=cl>            <span class=n>slow</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># Makes actions run slower</span>
</span></span><span class=line><span class=cl>            <span class=n>incognito</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=c1># Enable Chromium&#39;s Incognito mode. Clear session cookies</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=k>as</span> <span class=n>sb</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>  <span class=c1># Clicking logic to get to appointment status</span>
</span></span><span class=line><span class=cl>            <span class=n>set_random_window_size</span><span class=p>(</span><span class=n>sb</span><span class=p>)</span>  <span class=c1># Adjust the browser window size (to avoid rate-limiting)</span>
</span></span></code></pre></div><h4 id=navigation>Navigation<a hidden class=anchor aria-hidden=true href=#navigation>#</a></h4><p>and navigating through the form by selecting options and clicking buttons, demonstrating how SeleniumBase simplifies interaction with web elements.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=p>)</span> <span class=k>as</span> <span class=n>sb</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>  <span class=c1># Clicking logic to get to appointment status</span>
</span></span><span class=line><span class=cl>    <span class=n>set_random_window_size</span><span class=p>(</span><span class=n>sb</span><span class=p>)</span>  <span class=c1># Adjust the browser window size (to avoid rate-limiting)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;url&#39;</span><span class=p>])</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>click</span><span class=p>(</span><span class=s2>&#34;#form&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>select_option_by_text</span><span class=p>(</span><span class=s2>&#34;#form&#34;</span><span class=p>,</span> <span class=s2>&#34;Barcelona&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>click</span><span class=p>(</span><span class=s2>&#34;#btnAceptar&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>select_option_by_text</span><span class=p>(</span><span class=s2>&#34;#tramiteGrupo</span><span class=se>\\</span><span class=s2>[0</span><span class=se>\\</span><span class=s2>]&#34;</span><span class=p>,</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;tramiteOptionText&#39;</span><span class=p>])</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>click</span><span class=p>(</span><span class=s2>&#34;#btnAceptar&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>click</span><span class=p>(</span><span class=s2>&#34;#btnEntrar&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>type</span><span class=p>(</span><span class=s2>&#34;#txtIdCitado&#34;</span><span class=p>,</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;idCitadoValue&#39;</span><span class=p>])</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>type</span><span class=p>(</span><span class=s2>&#34;#txtDesCitado&#34;</span><span class=p>,</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;desCitadoValue&#39;</span><span class=p>])</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>select_option_by_text</span><span class=p>(</span><span class=s2>&#34;#txtPaisNac&#34;</span><span class=p>,</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;paisNacValue&#39;</span><span class=p>])</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>click</span><span class=p>(</span><span class=s2>&#34;#btnEnviar&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sb</span><span class=o>.</span><span class=n>click</span><span class=p>(</span><span class=s2>&#34;#btnEnviar&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=checking-for-availability>Checking for Availability<a hidden class=anchor aria-hidden=true href=#checking-for-availability>#</a></h4><p>It then checks for text indicating whether appointments are available. If not found, it assumes availability and proceeds to take a screenshot for evidence, showcasing SeleniumBase&rsquo;s ability to easily interact with web pages and perform checks.
<img loading=lazy src=/posts/selenium_automation/cita-check-selector.png alt=selector></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Checking for appointment availability</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>sb</span><span class=o>.</span><span class=n>is_text_visible</span><span class=p>(</span><span class=s2>&#34;En este momento no hay citas disponibles.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=s2>&#34;div.mf-main--content.ac-custom-content p&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;No available appointments. Trying again in 10 minutes.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=k>return</span> <span class=s2>&#34;retry&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=c1># If the text is not found, assume an appointment is available</span>
</span></span><span class=line><span class=cl>      <span class=n>sb</span><span class=o>.</span><span class=n>set_window_size</span><span class=p>(</span><span class=mi>1280</span><span class=p>,</span> <span class=mi>1024</span><span class=p>)</span>  <span class=c1># Set correct resolution for screenshot</span>
</span></span><span class=line><span class=cl>      <span class=n>sb</span><span class=o>.</span><span class=n>save_screenshot</span><span class=p>(</span><span class=s2>&#34;/tmp/cita_disponible.png&#34;</span><span class=p>)</span>  <span class=c1># Take a screenshot for the email attachment</span>
</span></span><span class=line><span class=cl>      <span class=n>send_email</span><span class=p>(</span><span class=s2>&#34;Cita Disponible Alert&#34;</span><span class=p>,</span> <span class=s2>&#34;VNC to vnc://127.0.0.1:5900 to complete&#34;</span><span class=p>,</span> <span class=n>attach_screenshot</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Appointments might be available. Keeping the browser open for manual check.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>user_input</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Type &#39;restart&#39; and enter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>user_input</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;restart&#34;</span><span class=p>:</span> <span class=c1># SB Context manager quits automatically. workaround to maintain open</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=s2>&#34;manual_check_needed&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encountered an error during the steps: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>. Trying again in 10 minutes.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=k>return</span> <span class=s2>&#34;error&#34;</span>
</span></span></code></pre></div><h4 id=email-notifications>Email Notifications<a hidden class=anchor aria-hidden=true href=#email-notifications>#</a></h4><p>Upon finding an available appointment, the script sends an email notification with the screenshot attached. This demonstrates integrating SeleniumBase with other Python libraries for complete automation solutions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_email</span><span class=p>(</span><span class=n>subject</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>attach_screenshot</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Load email configuration from values.json</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;/tmp/values.json&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sender_email</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;sender_email&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>receiver_email</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;receiver_email&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>smtp_server</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;smtp_server&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>smtp_port</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;smtp_port&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create the email message</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span> <span class=o>=</span> <span class=n>EmailMessage</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;Subject&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>subject</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;From&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sender_email</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span><span class=p>[</span><span class=s1>&#39;To&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>receiver_email</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span><span class=o>.</span><span class=n>set_content</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Attach the screenshot if required</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>attach_screenshot</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>screenshot_path</span> <span class=o>=</span> <span class=s2>&#34;/tmp/cita_disponible.png&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>screenshot_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>screenshot_path</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>file_data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>file_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>screenshot_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>msg</span><span class=o>.</span><span class=n>add_attachment</span><span class=p>(</span><span class=n>file_data</span><span class=p>,</span> <span class=n>maintype</span><span class=o>=</span><span class=s1>&#39;image&#39;</span><span class=p>,</span> <span class=n>subtype</span><span class=o>=</span><span class=s1>&#39;png&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=o>=</span><span class=n>file_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Send the email</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>smtplib</span><span class=o>.</span><span class=n>SMTP_SSL</span><span class=p>(</span><span class=n>smtp_server</span><span class=p>,</span> <span class=n>smtp_port</span><span class=p>)</span> <span class=k>as</span> <span class=n>smtp</span><span class=p>:</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>            <span class=n>smtp</span><span class=o>.</span><span class=n>login</span><span class=p>(</span><span class=n>sender_email</span><span class=p>,</span> <span class=n>password</span><span class=p>)</span>  <span class=c1># Fetches values.json</span>
</span></span><span class=line><span class=cl>            <span class=n>smtp</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Email sent successfully!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error sending email: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Once the script finds an available appointment you&rsquo;ll receive an email alert with a screenshot:
<img loading=lazy src=/posts/selenium_automation/email-alert.png alt=alert></p><p>You can set up a distinct alarm tone on your mobile phone for a particular sender to alert you during off-hours, as if you were on call.</p><h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3><p>This detailed exploration showcases the power and versatility of using Docker and SeleniumBase for automating the task of checking for available appointments. Through practical examples and explanations, we&rsquo;ve seen how these technologies can streamline the development and deployment of automation scripts, ensuring reliability, efficiency, and scalability in modern web application testing and automation tasks.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tbalza.net/tags/docker/>Docker</a></li><li><a href=https://tbalza.net/tags/selenium/>Selenium</a></li><li><a href=https://tbalza.net/tags/python/>Python</a></li><li><a href=https://tbalza.net/tags/git/>Git</a></li><li><a href=https://tbalza.net/tags/automation/>Automation</a></li></ul><nav class=paginav><a class=next href=https://tbalza.net/container-orchestration-of-ha-application-with-ecs/><span class=title>Next »</span><br><span>Container Orchestration of HA Application with ECS</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://tbalza.net/>Tomas Balza</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>