<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Blog Deployment on Github Pages using Github Actions | Tomas Balza</title>
<meta name=keywords content="git,automation,cost optimization"><meta name=description content="In this article we will go through the steps of setting up a static website, that will not incur in storage costs or egress fees."><meta name=author content><link rel=canonical href=https://tbalza.net/blog-deployment-on-github-pages-using-github-actions/><link crossorigin=anonymous href=/assets/css/stylesheet.72f49d8e688f8b26198abd212dc2ce9fe1d22eddc415e9c17e8ac38ab047d5ab.css integrity="sha256-cvSdjmiPiyYZir0hLcLOn+HSLt3EFenBforDirBH1as=" rel="preload stylesheet" as=style><link rel=icon href=https://tbalza.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tbalza.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tbalza.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tbalza.net/apple-touch-icon.png><link rel=mask-icon href=https://tbalza.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tbalza.net/blog-deployment-on-github-pages-using-github-actions/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Blog Deployment on Github Pages using Github Actions"><meta property="og:description" content="In this article we will go through the steps of setting up a static website, that will not incur in storage costs or egress fees."><meta property="og:type" content="article"><meta property="og:url" content="https://tbalza.net/blog-deployment-on-github-pages-using-github-actions/"><meta property="og:image" content="https://tbalza.net/posts/blog_hugo/cover.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-28T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tbalza.net/posts/blog_hugo/cover.jpg"><meta name=twitter:title content="Blog Deployment on Github Pages using Github Actions"><meta name=twitter:description content="In this article we will go through the steps of setting up a static website, that will not incur in storage costs or egress fees."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tbalza.net/posts/"},{"@type":"ListItem","position":2,"name":"Blog Deployment on Github Pages using Github Actions","item":"https://tbalza.net/blog-deployment-on-github-pages-using-github-actions/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Blog Deployment on Github Pages using Github Actions","name":"Blog Deployment on Github Pages using Github Actions","description":"In this article we will go through the steps of setting up a static website, that will not incur in storage costs or egress fees.","keywords":["git","automation","cost optimization"],"articleBody":"In this guide, we’ll walk you through the process of creating a static website that won’t burden you with storage costs or egress fees\nWe’ll also help you set up a custom domain that will automatically reflect any changes made whenever a new commit is detected in the main branch of our version control system.\nThe Problem with Egress Traffic Whether you’re operating an EC2 instance or directly serving files via S3, egress traffic can come with a price tag. For instance, AWS charges around $0.023 per GB. While this might not seem like much for personal pages, without the necessary precautions like DDoS protection or rate limiting, you could potentially face a hefty bill running into the thousands of dollars in the event of an attack. Fortunately, this won’t be an issue with our setup.\nThe Solution: Free Tier Services This is why it’s a smart move to utilize services like GitHub Pages and CloudFlare for a public personal site. These platforms don’t charge for outgoing traffic, even on their free tier service, making them an ideal solution.\nWhy Choose Hugo? Hugo is a static site generator written in Go. It’s not only incredibly fast but also simple to set up. The resulting pages load swiftly and are SEO optimized right from the start. This makes Hugo a fantastic alternative to platforms like WordPress, where publishing static content can be a bit of a hassle in terms of maintenance, costs, and performance.\nConfigure Your Personal Domain First, purchase your domain with services such as namecheap.com, then you can access the advanced settings and configure the records that will point to the GitHub Page that will reference to later Set up the A Records and CNAME just like in the image above. Reference the Github Pages Apex Configuration for further details. You can skip this step if you’d wish to deploy the site without a custom domain Set up Hugo Install Hugo and Create a New Site brew install hugo hugo new site tbalza-blog-hugo -f yml Install Hugo with Homebrew\nRun hugo new site . This will create a directory containing the hugo templates. Pass in the -f yml argument so configuration files are stored in the yml format\nInstall Theme git init git submodule add --depth=1 https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod git submodule update --init --recursive # needed when you reclone your repo (submodules may not get cloned automatically) git submodule update --remote --merge Run git init on the root of the project to initialize a Git repository Install the PaperMod theme using Git Submodules theme: [\"PaperMod\"] Add the theme parameter in hugo.yaml baseURL: https://tbalza.net/ Add the baseURL parameter in hugo.yaml hugo server Run this command from within the project folder. This will create a blank page with no content Configure GitHub Actions to Publish to the GitHub Pages Push the First Commit, Create gh-pages Branch git commit -m \"first commit\" git branch -M main # rename master to main git remote add origin https://github.com/tbalza/tbalza-blog-hugo # replace with your repo git push -u origin main git branch gh-pages # used internally by github to execute the deployment action, will throw error if not created Create a repository on GitHub, add the remote address, and push your first commit, create gh-pages branch Allow Read and Write Permissions Under Settings \u003e Actions \u003e General \u003e Workflow permissions, enable “Read and write permissions” Set up Custom Domain in GitHub Pages Configure your custom domain under Settings \u003e Pages \u003e Custom Domain Create deploy.yml mkdir -p .github/workflows cd .github/workflows touch deploy.yml In you project root folder create .github/workflows/deploy.yml name: Publish to GH Pages on: push: branches: - main pull_request: jobs: deploy: runs-on: ubuntu-latest steps: - name: Checkout source uses: actions/checkout@v3 with: submodules: true - name: Checkout destination uses: actions/checkout@v3 if: github.ref == 'refs/heads/main' with: ref: gh-pages path: built-site - name: Setup Hugo run: | curl -L -o /tmp/hugo.tar.gz 'https://github.com/gohugoio/hugo/releases/download/v0.123.4/hugo_0.123.4_linux-amd64.tar.gz' tar -C ${RUNNER_TEMP} -zxvf /tmp/hugo.tar.gz hugo - name: Build run: ${RUNNER_TEMP}/hugo - name: Deploy if: github.ref == 'refs/heads/main' run: | cp -R public/* ${GITHUB_WORKSPACE}/built-site/ cd ${GITHUB_WORKSPACE}/built-site git add . git config user.name 'tbalza' git config user.email 'tomas.balza@gmail.com' git commit -m 'Updated site' git push Checkout source This action checks-out your repository under $GITHUB_WORKSPACE, so your workflow can access it. submodules:true ensures that our submodule for the theme repository is fetched as well Checkout destination The second step allows us to reference the gh-pages branch via the $GITHUB_WORKSPACE/built-site directory, where our static sites will be stored in Setup Hugo This step downloads and extracts the Hugo static site generator. It uses curl to download a specific version of Hugo from its GitHub releases page, and tar to extract the downloaded file. Build This step runs Hugo to build your static site. The built site’s files are placed in the public directory. Deploy This step deploys the built site to the gh-pages branch. It first copies the built site’s files from the public directory to the built-site directory. It then changes the current directory to built-site, stages all changes for commit with git add ., sets the Git username and email, commits the changes with a message of ‘Updated site’, and finally pushes the commit to the gh-pages branch. The gh-pages branch is special because GitHub Pages serves the contents of this branch at your GitHub Pages URL. The if: github.ref == 'refs/heads/main' condition ensures that the site is only deployed when changes are pushed to the main branch.\nAfter the deploy.yml workflow is pushed, any future changes in the main branch, will trigger Hugo to generate an updated /public/ folder and serve it in GitHub Pages.\n","wordCount":"929","inLanguage":"en","image":"https://tbalza.net/posts/blog_hugo/cover.jpg","datePublished":"2024-02-28T00:00:00Z","dateModified":"2024-02-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tbalza.net/blog-deployment-on-github-pages-using-github-actions/"},"publisher":{"@type":"Organization","name":"Tomas Balza","logo":{"@type":"ImageObject","url":"https://tbalza.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tbalza.net/ accesskey=h title="Tomas Balza (Alt + H)"><img src=https://tbalza.net/profile-photo-2.jpg alt aria-label=logo height=35>Tomas Balza<p id=subtitle>DevOps / Tech Articles</p></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://github.com/tbalza title=GitHub><span>GitHub</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/tomas-balza-b075141b3 title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.youtube.com/@tbalza-tech title=YouTube><span>YouTube</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Blog Deployment on Github Pages using Github Actions</h1><div class=post-meta><span title='2024-02-28 00:00:00 +0000 UTC'>February, 2024</span>&nbsp;&nbsp;&nbsp;<a href=/tags/git> git</a> <a href=/tags/automation>automation</a> <a href=/tags/cost-optimization>cost optimization</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-problem-with-egress-traffic aria-label="The Problem with Egress Traffic">The Problem with Egress Traffic</a><ul><li><a href=#the-solution-free-tier-services aria-label="The Solution: Free Tier Services">The Solution: Free Tier Services</a></li><li><a href=#why-choose-hugo aria-label="Why Choose Hugo?">Why Choose Hugo?</a></li></ul></li><li><a href=#configure-your-personal-domain aria-label="Configure Your Personal Domain">Configure Your Personal Domain</a></li><li><a href=#set-up-hugo aria-label="Set up Hugo">Set up Hugo</a><ul><li><a href=#install-hugo-and-create-a-new-site aria-label="Install Hugo and Create a New Site">Install Hugo and Create a New Site</a></li><li><a href=#install-theme aria-label="Install Theme">Install Theme</a></li></ul></li><li><a href=#configure-github-actions-to-publish-to-the-github-pages aria-label="Configure GitHub Actions to Publish to the GitHub Pages">Configure GitHub Actions to Publish to the GitHub Pages</a><ul><li><a href=#push-the-first-commit-create-gh-pages-branch aria-label="Push the First Commit, Create gh-pages Branch">Push the First Commit, Create gh-pages Branch</a></li><li><a href=#allow-read-and-write-permissions aria-label="Allow Read and Write Permissions">Allow Read and Write Permissions</a></li><li><a href=#set-up-custom-domain-in-github-pages aria-label="Set up Custom Domain in GitHub Pages">Set up Custom Domain in GitHub Pages</a></li><li><a href=#create-deployyml aria-label="Create deploy.yml">Create deploy.yml</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"),document.querySelectorAll(".inner ul li a").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href").slice(1),n=document.getElementById(t);window.scrollTo({top:getOffsetTop(n)-75,behavior:"smooth"})})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset-60>0&&getOffsetTop(e)-window.pageYOffset-60<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.scrollY}</script><div class=post-content><p>In this guide, we&rsquo;ll walk you through the process of creating a static website that won&rsquo;t burden you with storage costs or egress fees</p><p>We&rsquo;ll also help you set up a custom domain that will automatically reflect any changes made whenever a new commit is detected in the main branch of our version control system.</p><h3 id=the-problem-with-egress-traffic>The Problem with Egress Traffic<a hidden class=anchor aria-hidden=true href=#the-problem-with-egress-traffic>#</a></h3><p>Whether you&rsquo;re operating an EC2 instance or directly serving files via S3, egress traffic can come with a price tag. For instance, AWS charges around $0.023 per GB. While this might not seem like much for personal pages, without the necessary precautions like DDoS protection or rate limiting, you could potentially face a hefty bill running into the thousands of dollars in the event of an attack. Fortunately, this won&rsquo;t be an issue with our setup.</p><p><img loading=lazy src=/posts/blog_hugo/huge_bill.png alt=huge></p><h4 id=the-solution-free-tier-services>The Solution: Free Tier Services<a hidden class=anchor aria-hidden=true href=#the-solution-free-tier-services>#</a></h4><p>This is why it&rsquo;s a smart move to utilize services like GitHub Pages and CloudFlare for a public personal site. These platforms don&rsquo;t charge for outgoing traffic, even on their free tier service, making them an ideal solution.</p><h4 id=why-choose-hugo>Why Choose Hugo?<a hidden class=anchor aria-hidden=true href=#why-choose-hugo>#</a></h4><p><a href=https://github.com/gohugoio/hugo>Hugo</a> is a static site generator written in Go. It&rsquo;s not only incredibly fast but also simple to set up. The resulting pages load swiftly and are SEO optimized right from the start. This makes Hugo a fantastic alternative to platforms like WordPress, where publishing static content can be a bit of a hassle in terms of maintenance, costs, and performance.</p><p><img loading=lazy src=/posts/blog_hugo/seo.png alt=seo></p><h3 id=configure-your-personal-domain>Configure Your Personal Domain<a hidden class=anchor aria-hidden=true href=#configure-your-personal-domain>#</a></h3><ul><li>First, purchase your domain with services such as namecheap.com, then you can access the advanced settings and configure the records that will point to the GitHub Page that will reference to later</li></ul><p><img loading=lazy src=/posts/blog_hugo/namecheap.png alt=namecheap></p><ul><li>Set up the A Records and CNAME just like in the image above. Reference the <a href=https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain>Github Pages Apex Configuration</a> for further details. You can skip this step if you&rsquo;d wish to deploy the site without a custom domain</li></ul><h3 id=set-up-hugo>Set up Hugo<a hidden class=anchor aria-hidden=true href=#set-up-hugo>#</a></h3><h4 id=install-hugo-and-create-a-new-site>Install Hugo and Create a New Site<a hidden class=anchor aria-hidden=true href=#install-hugo-and-create-a-new-site>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install hugo
</span></span><span class=line><span class=cl>hugo new site tbalza-blog-hugo -f yml
</span></span></code></pre></div><ul><li><p>Install Hugo with Homebrew</p></li><li><p>Run hugo new site <code>&lt;site_name></code>. This will create a directory <code>&lt;site_name></code> containing the hugo templates. Pass in the <code>-f yml</code> argument so configuration files are stored in the yml format</p></li></ul><h4 id=install-theme>Install Theme<a hidden class=anchor aria-hidden=true href=#install-theme>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git init
</span></span><span class=line><span class=cl>git submodule add --depth<span class=o>=</span><span class=m>1</span> https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod
</span></span><span class=line><span class=cl>git submodule update --init --recursive <span class=c1># needed when you reclone your repo (submodules may not get cloned automatically)</span>
</span></span><span class=line><span class=cl>git submodule update --remote --merge
</span></span></code></pre></div><ul><li>Run git init on the root of the project to initialize a Git repository</li><li>Install the <a href=https://github.com/adityatelange/hugo-PaperMod>PaperMod theme</a> using Git Submodules</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>theme</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;PaperMod&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><ul><li>Add the theme parameter in <code>hugo.yaml</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>baseURL</span><span class=p>:</span><span class=w> </span><span class=l>https://tbalza.net/</span><span class=w>
</span></span></span></code></pre></div><ul><li>Add the baseURL parameter in <code>hugo.yaml</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hugo server
</span></span></code></pre></div><ul><li>Run this command from within the project folder. This will create a blank page with no content</li></ul><h3 id=configure-github-actions-to-publish-to-the-github-pages>Configure GitHub Actions to Publish to the GitHub Pages<a hidden class=anchor aria-hidden=true href=#configure-github-actions-to-publish-to-the-github-pages>#</a></h3><h4 id=push-the-first-commit-create-gh-pages-branch>Push the First Commit, Create gh-pages Branch<a hidden class=anchor aria-hidden=true href=#push-the-first-commit-create-gh-pages-branch>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git commit -m <span class=s2>&#34;first commit&#34;</span>
</span></span><span class=line><span class=cl>git branch -M main <span class=c1># rename master to main</span>
</span></span><span class=line><span class=cl>git remote add origin https://github.com/tbalza/tbalza-blog-hugo <span class=c1># replace with your repo</span>
</span></span><span class=line><span class=cl>git push -u origin main
</span></span><span class=line><span class=cl>git branch gh-pages <span class=c1># used internally by github to execute the deployment action, will throw error if not created</span>
</span></span></code></pre></div><ul><li>Create a repository on GitHub, add the remote address, and push your first commit, create gh-pages branch</li></ul><h4 id=allow-read-and-write-permissions>Allow Read and Write Permissions<a hidden class=anchor aria-hidden=true href=#allow-read-and-write-permissions>#</a></h4><p><img loading=lazy src=/posts/blog_hugo/read-write-permissions.png alt=read-write-permissions></p><ul><li>Under Settings > Actions > General > Workflow permissions, enable &ldquo;Read and write permissions&rdquo;</li></ul><h4 id=set-up-custom-domain-in-github-pages>Set up Custom Domain in GitHub Pages<a hidden class=anchor aria-hidden=true href=#set-up-custom-domain-in-github-pages>#</a></h4><p><img loading=lazy src=/posts/blog_hugo/github-custom-dns.png alt=github-custom-dns></p><ul><li>Configure your custom domain under Settings > Pages > Custom Domain</li></ul><h4 id=create-deployyml>Create deploy.yml<a hidden class=anchor aria-hidden=true href=#create-deployyml>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p .github/workflows
</span></span><span class=line><span class=cl><span class=nb>cd</span> .github/workflows
</span></span><span class=line><span class=cl>touch deploy.yml
</span></span></code></pre></div><ul><li>In you project root folder create .github/workflows/deploy.yml</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Publish to GH Pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout source</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout destination</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.ref == &#39;refs/heads/main&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=l>gh-pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>built-site</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          curl -L -o /tmp/hugo.tar.gz &#39;https://github.com/gohugoio/hugo/releases/download/v0.123.4/hugo_0.123.4_linux-amd64.tar.gz&#39;
</span></span></span><span class=line><span class=cl><span class=sd>          tar -C ${RUNNER_TEMP} -zxvf /tmp/hugo.tar.gz hugo
</span></span></span><span class=line><span class=cl><span class=sd>          </span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>${RUNNER_TEMP}/hugo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.ref == &#39;refs/heads/main&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          cp -R public/* ${GITHUB_WORKSPACE}/built-site/
</span></span></span><span class=line><span class=cl><span class=sd>          cd ${GITHUB_WORKSPACE}/built-site
</span></span></span><span class=line><span class=cl><span class=sd>          git add .
</span></span></span><span class=line><span class=cl><span class=sd>          git config user.name &#39;tbalza&#39;
</span></span></span><span class=line><span class=cl><span class=sd>          git config user.email &#39;tomas.balza@gmail.com&#39;
</span></span></span><span class=line><span class=cl><span class=sd>          git commit -m &#39;Updated site&#39;
</span></span></span><span class=line><span class=cl><span class=sd>          git push</span><span class=w>          
</span></span></span></code></pre></div><ul><li><ol><li><strong>Checkout source</strong> This action checks-out your repository under <code>$GITHUB_WORKSPACE</code>, so your workflow can access it.
<code>submodules:true</code> ensures that our submodule for the theme repository is fetched as well</li></ol></li><li><ol start=2><li><strong>Checkout destination</strong> The second step allows us to reference the <code>gh-pages</code> branch via the <code>$GITHUB_WORKSPACE/built-site</code> directory, where our static sites will be stored in</li></ol></li><li><ol start=3><li><strong>Setup Hugo</strong> This step downloads and extracts the Hugo static site generator. It uses <code>curl</code> to download a specific version of Hugo from its GitHub releases page, and <code>tar</code> to extract the downloaded file.</li></ol></li><li><ol start=4><li><strong>Build</strong> This step runs Hugo to build your static site. The built site&rsquo;s files are placed in the <code>public</code> directory.</li></ol></li><li><ol start=5><li><strong>Deploy</strong> This step deploys the built site to the <code>gh-pages</code> branch. It first copies the built site&rsquo;s files from the <code>public</code> directory to the <code>built-site</code> directory. It then changes the current directory to <code>built-site</code>, stages all changes for commit with <code>git add .</code>, sets the Git username and email, commits the changes with a message of &lsquo;Updated site&rsquo;, and finally pushes the commit to the <code>gh-pages</code> branch.</li></ol></li></ul><p>The <code>gh-pages</code> branch is special because GitHub Pages serves the contents of this branch at your GitHub Pages URL. The <code>if: github.ref == 'refs/heads/main'</code> condition ensures that the site is only deployed when changes are pushed to the main branch.</p><p><img loading=lazy src=/posts/blog_hugo/deploy.png alt=deploy></p><p>After the <code>deploy.yml</code> workflow is pushed, any future changes in the main branch, will trigger Hugo to generate an updated <code>/public/</code> folder and serve it in GitHub Pages.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tbalza.net/tags/git/>Git</a></li><li><a href=https://tbalza.net/tags/automation/>Automation</a></li><li><a href=https://tbalza.net/tags/cost-optimization/>Cost Optimization</a></li></ul><nav class=paginav><a class=prev href=https://tbalza.net/using-terraform-for-amazon-api-gateway-deployment/><span class=title>« Prev</span><br><span>Using Terraform for Amazon API Gateway Deployment</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://tbalza.net/>Tomas Balza</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>